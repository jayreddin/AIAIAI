| prd_content                                                                                                                                                                                                                                                                                                                                                                                   |
|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| # PRD: Puter AI Chat App                                                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Develop a web-based AI chat application using Puter.js that allows users to interact with various AI models, generate images, perform OCR/Vision tasks, use TTS, and manage settings.                                                                                                                                                                                               |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Framework:** Vanilla JS (index.html, style.css, script.js)                                                                                                                                                                                                                                                                                                                                  |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 1: Basic Setup & Authentication (Completed) âœ…                                                                                                                                                                                                                                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Create the basic file structure, include the Puter SDK, and set up user authentication.                                                                                                                                                                                                                                                                                             |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  Create Files (Completed)                                                                                                                                                                                                                                                                                                                                                                  |
| 2.  Include SDK (Completed) [cite: index.html]                                                                                                                                                                                                                                                                                                                                                |
| 3.  Implement Authentication (Completed) [cite: index.html, script.js, 771-777, 149-155]                                                                                                                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 2: Core Chat UI Elements                                                                                                                                                                                                                                                                                                                                                             |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the basic HTML structure and CSS for the main chat interface components. *No functionality yet.*                                                                                                                                                                                                                                                                          |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Header:** Add an HTML container for the header (placeholder for future dropdown).                                                                                                                                                                                                                                                                                                       |
| 2.  **Message Area:** Create a `div` (`id="message-display"`) to hold chat messages. Add basic CSS for height and overflow (initially visible scroll).                                                                                                                                                                                                                                        |
| 3.  **Input Area:** Create a container (`div`) at the bottom.                                                                                                                                                                                                                                                                                                                                 |
| 4.  **Text Input:** Add a `textarea` (`id="chat-input"`) inside the input area container for user messages.                                                                                                                                                                                                                                                                                   |
| 5.  **Send Button:** Add a `button` (`id="send-button"`) next to the text input.                                                                                                                                                                                                                                                                                                              |
| 6.  **Mic Button:** Add a placeholder `button` (`id="mic-button"`) to the left of the text input.                                                                                                                                                                                                                                                                                             |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 3: Basic Chat Logic                                                                                                                                                                                                                                                                                                                                                                  |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Connect the input and button to `puter.ai.chat()` using the default model and display the basic text request/response in the message area.                                                                                                                                                                                                                                          |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Send Action:** Add JS event listener to the Send Button and check for 'Enter' key press in the text input.                                                                                                                                                                                                                                                                              |
| 2.  **Get Input:** Retrieve text from the input area.                                                                                                                                                                                                                                                                                                                                         |
| 3.  **Display User Msg:** Append the user's message to the message display area.                                                                                                                                                                                                                                                                                                              |
| 4.  **Call AI:** Call `puter.ai.chat(prompt)` with the user's input [cite: 5-6].                                                                                                                                                                                                                                                                                                              |
| 5.  **Display AI Msg:** Append the AI's response text to the message display area.                                                                                                                                                                                                                                                                                                            |
| 6.  **Clear Input:** Clear the text input area after sending.                                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 4: Model Selection Dropdown                                                                                                                                                                                                                                                                                                                                                          |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Allow users to choose different AI models for the chat.                                                                                                                                                                                                                                                                                                                             |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Add Dropdown:** Add an HTML `select` element (`id="model-selector"`) to the header container.                                                                                                                                                                                                                                                                                           |
| 2.  **Populate Models:** Use JS to fetch available models (referencing `puterAPI.txt` list [cite: 8-9]) and populate the dropdown options.                                                                                                                                                                                                                                                    |
| 3.  **Store Selection:** Store the currently selected model ID in a JS variable when the dropdown changes.                                                                                                                                                                                                                                                                                    |
| 4.  **Update AI Call:** Modify the `puter.ai.chat` call in Phase 3 to include the selected model in the `options` object [cite: 7-9].                                                                                                                                                                                                                                                         |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 5: Chat Bubbles & Styling                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Style the chat messages as bubbles, align them, add timestamps, and improve the message area scroll.                                                                                                                                                                                                                                                                                |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **CSS Bubbles:** Add CSS rules to style user messages (e.g., right-aligned, specific background) and AI messages (e.g., left-aligned, different background).                                                                                                                                                                                                                              |
| 2.  **JS Structure:** Update the JS functions (from Phase 3) that append messages to create the necessary HTML structure (e.g., divs for bubble, sender, timestamp).                                                                                                                                                                                                                          |
| 3.  **Timestamps:** Add timestamps (using JS `Date()`) when displaying messages.                                                                                                                                                                                                                                                                                                              |
| 4.  **Hidden Scrollbar:** Add CSS to hide the default scrollbar for the message display area while maintaining scrollability (`overflow-y: scroll; scrollbar-width: none; ::-webkit-scrollbar { display: none; }`).                                                                                                                                                                           |
| 5.  **Scroll to Bottom:** Add JS to automatically scroll the message display area to the bottom when a new message is added.                                                                                                                                                                                                                                                                  |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 6: Bottom Banner & Basic Popups                                                                                                                                                                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Create the banner row with icons and implement basic dismissible popup containers.                                                                                                                                                                                                                                                                                                  |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **HTML Banner:** Create a `div` (`id="bottom-banner"`) below the message area and above the input area. Style it to be transparent/hidden background.                                                                                                                                                                                                                                     |
| 2.  **HTML Icons:** Add `button` elements with placeholder icons (or text initially) inside the banner for: New Chat, History, Image Gen, OCR, Vision, TTS, Settings.                                                                                                                                                                                                                         |
| 3.  **Basic Popups:** Add JS event listeners to banner buttons. When clicked, dynamically create/show a basic popup `div` container (styled with rounded border). *Consider using `puter.ui.createWindow()` [cite: 552-560] for OS-level popups or custom HTML divs for in-page popups.*                                                                                                      |
| 4.  **Dismiss Logic:** Implement JS logic to hide the popup when the user clicks outside its frame (easier for custom HTML divs).                                                                                                                                                                                                                                                             |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 7: Message Action Buttons                                                                                                                                                                                                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Add icon buttons below chat bubbles and implement their basic functions.                                                                                                                                                                                                                                                                                                            |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **HTML/JS Buttons:** Update message appending logic (Phase 5) to include small icon buttons (Resend, Copy, Delete, Speak) below each bubble.                                                                                                                                                                                                                                              |
| 2.  **Copy:** Implement JS for the Copy button (read text content of the bubble, use `navigator.clipboard.writeText`).                                                                                                                                                                                                                                                                        |
| 3.  **Delete:** Implement JS for the Delete button (remove the message bubble element from the DOM).                                                                                                                                                                                                                                                                                          |
| 4.  **Speak:** Add JS event listener for Speak button to call `puter.ai.txt2speech(messageText)` [cite: 69-76] and play the resulting audio.                                                                                                                                                                                                                                                  |
| 5.  **Resend:** Implement JS for Resend button (get message text, put it in input box OR directly call Phase 3's AI logic with it).                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 8: New Chat & History                                                                                                                                                                                                                                                                                                                                                                |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement "+ New Chat" and the "Chat History" popup.                                                                                                                                                                                                                                                                                                                                |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **New Chat:** Add JS logic to the "+ New Chat" banner button to: clear the message display area, potentially reset the selected model, and save the *current* chat session to history.                                                                                                                                                                                                    |
| 2.  **History Storage:** Use `puter.kv` [cite: 304-352] for saving chat history (array of message objects, timestamp, model used). Keys could be like `chatHistory_timestamp`. `puter.kv.list('chatHistory_*')` [cite: 333-346] to retrieve list.                                                                                                                                             |
| 3.  **History Popup UI:** Design the History popup (from Phase 6) to show a scrollable list of saved chats retrieved via `puter.kv.list()`.                                                                                                                                                                                                                                                   |
| 4.  **Load History:** Implement JS to load saved chat data using `puter.kv.get(key)` [cite: 321-327].                                                                                                                                                                                                                                                                                         |
| 5.  **Restore Chat:** Add JS event listeners to list items. When clicked, load the selected chat messages back into the main display area, restore the associated AI model in the dropdown, and dismiss the popup.                                                                                                                                                                            |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 9: TTS Chat Mode                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the TTS popup/mode for audio interaction.                                                                                                                                                                                                                                                                                                                                 |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **TTS Popup UI:** Design the TTS popup (from Phase 6). Include text input, Mic button (link to Phase 10), and potentially an audio player element or status indicator.                                                                                                                                                                                                                    |
| 2.  **AI Call:** When user submits text/speech, call `puter.ai.chat()`.                                                                                                                                                                                                                                                                                                                       |
| 3.  **Speak Response:** Take the AI's text response and call `puter.ai.txt2speech()` [cite: 69-76]. Play the returned audio automatically.                                                                                                                                                                                                                                                    |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 10: Microphone Input                                                                                                                                                                                                                                                                                                                                                                 |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement speech-to-text for the main chat input and potentially other inputs.                                                                                                                                                                                                                                                                                                      |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Mic Button Logic:** Add JS event listener to the Mic button (Phase 2).                                                                                                                                                                                                                                                                                                                  |
| 2.  **Web Speech API:** Use the browser's Web Speech API (`SpeechRecognition`) to capture audio and transcribe it to text. *Note: This is standard JS, not Puter.js specific. Check browser compatibility.*                                                                                                                                                                                   |
| 3.  **Update Input:** Populate the main text input (`#chat-input`) with the transcribed text.                                                                                                                                                                                                                                                                                                 |
| 4.  **UI Feedback:** Implement visual feedback (e.g., changing Mic icon color) when recording is active.                                                                                                                                                                                                                                                                                      |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 11: Image Generation Popup                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the Image Generation popup with variations.                                                                                                                                                                                                                                                                                                                               |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Image Gen Popup UI:** Design the main Image Gen popup (Phase 6). Add display box (initially hidden), banner row (Story, Card, Comic), text input, and Generate button. Add scroll capabilities if needed.                                                                                                                                                                               |
| 2.  **Basic Image Gen:** Implement `puter.ai.txt2img(prompt)` [cite: 62-68] call when Generate is clicked. Display result (likely data URL [cite: 65]) in the display box (`<img>` tag). Implement thumbnail click-to-expand and save (`<a>` tag with download attribute or `puter.ui.showSaveFilePicker` [cite: 651-655]).                                                                   |
| 3.  **Story Mode UI:** Implement UI changes for "Story" button (3 text boxes, options).                                                                                                                                                                                                                                                                                                       |
| 4.  **Story Mode Logic:** Combine inputs, structure prompts for `puter.ai.chat()` (for text) and `puter.ai.txt2img()` (for images). Display formatted result with text and image thumbnails. Implement PDF generation (requires external JS PDF library like jsPDF). Add carousel for expanded images. Add button on main UI for PDF download.                                                |
| 5.  **Card Mode UI:** Implement UI changes for "Card" button (dropdown, 4 text boxes, generate button).                                                                                                                                                                                                                                                                                       |
| 6.  **Card Mode Logic:** Combine inputs, structure prompt for `puter.ai.txt2img()`. Display generated card thumbnail. Implement save/edit logic.                                                                                                                                                                                                                                              |
| 7.  **Comic Mode UI:** Implement UI changes for "Comic" button (similar to Story).                                                                                                                                                                                                                                                                                                            |
| 8.  **Comic Mode Logic:** Similar to Story mode logic, generating comic panels using text and `puter.ai.txt2img()`. Implement PDF generation.                                                                                                                                                                                                                                                 |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 12: OCR Popup                                                                                                                                                                                                                                                                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the OCR popup.                                                                                                                                                                                                                                                                                                                                                            |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **OCR Popup UI:** Design OCR popup (Phase 6). Add Upload button, image thumbnail area (with remove 'X'), Extract button, and editable text display box (e.g., `textarea`) with Copy button. Add scroll capabilities.                                                                                                                                                                      |
| 2.  **Image Upload:** Use `<input type="file">` (standard JS) for image selection. Display thumbnail with remove option.                                                                                                                                                                                                                                                                      |
| 3.  **Extract Logic:** On Extract click, get the `File` object, call `puter.ai.img2txt(imageFile)` [cite: 55-62].                                                                                                                                                                                                                                                                             |
| 4.  **Display Text:** Show returned text in the `textarea`. Implement copy button (`navigator.clipboard.writeText`).                                                                                                                                                                                                                                                                          |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 13: Vision Popup                                                                                                                                                                                                                                                                                                                                                                     |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the Vision popup using camera input.                                                                                                                                                                                                                                                                                                                                      |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Vision Popup UI:** Design Vision popup (Phase 6). Add "Enable Camera" button, `<video>` preview area, control buttons (flip, stop, describe), text display area, action buttons (clear, speak, copy text, save image). Add scroll capabilities. Make video preview draggable/resizable using CSS/JS.                                                                                    |
| 2.  **Camera Access:** Use `navigator.mediaDevices.getUserMedia` (standard JS) to access camera and stream to `<video>`. Handle permissions. Implement flip/stop logic.                                                                                                                                                                                                                       |
| 3.  **Describe Logic:** On Describe click, capture frame from video (e.g., draw to hidden `<canvas>`, get data URL `canvas.toDataURL()`). Call `puter.ai.chat(prompt, imageDataUrl)` using a vision-capable model [cite: 6, 13, 26].                                                                                                                                                          |
| 4.  **Display Description:** Show AI text response. Implement Clear button.                                                                                                                                                                                                                                                                                                                   |
| 5.  **Speak Description:** Implement Speak button using `puter.ai.txt2speech()` [cite: 69-76].                                                                                                                                                                                                                                                                                                |
| 6.  **Save Image/Text:** Implement Copy Text (`navigator.clipboard.writeText`) and Save Image (using the captured data URL and `<a>` download or `puter.ui.showSaveFilePicker`).                                                                                                                                                                                                              |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ## Phase 14: Settings Popup                                                                                                                                                                                                                                                                                                                                                                   |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| **Goal:** Implement the Settings popup with persistence.                                                                                                                                                                                                                                                                                                                                      |
| **Steps:**                                                                                                                                                                                                                                                                                                                                                                                    |
| 1.  **Settings Popup UI:** Design Settings popup (Phase 6) with Tabs (Models, UI, About). Add scroll capabilities. Add Save buttons where needed.                                                                                                                                                                                                                                             |
| 2.  **Models Tab:** List available AI models (from `puterAPI.txt` [cite: 8-9]) with checkboxes. Implement enable/disable all. On Save, store selected models list using `puter.kv.set('settings_models', JSON.stringify(selectedModels))` [cite: 346-352]. On app load, use `puter.kv.get('settings_models')` [cite: 321-327] to retrieve settings and update the main UI dropdown (Phase 4). |
| 3.  **UI Tab:** Implement Theme dropdown (apply CSS class changes to `<body>`), Text Size slider (update CSS variable or base font size). On Save, store settings using `puter.kv.set('settings_ui', JSON.stringify({theme: ..., textSize: ...}))`. Load and apply settings on app start.                                                                                                     |
| 4.  **About Tab:** Add static text with links as requested (`<a>` tags). Add Dismiss button.                                                                                                                                                                                                                                                                                                  |
|                                                                                                                                                                                                                                                                                                                                                                                               |
| ---                                                                                                                                                                                                                                                                                                                                                                                           |
| *(Phases can be re-ordered or adjusted based on development progress and priorities)*                                                                                                                                                                                                                                                                                                         |